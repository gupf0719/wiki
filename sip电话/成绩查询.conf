[code]
[globals]                                                         ;定义全局变量
;................................................mysql
DBCurrentHost=localhost
DBuser=root
DBpass=888888
DBname=asterisk_test
;........................................
[from-internal]                                                ;欢迎提示，xxxxxx按1或按2
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n(read1),Read(a,stu/welcome,1,,2,5)
exten => _x.,n(lan1),Gotoif($["${a}"="1"]?menu1,${EXTEN},1:lan2)
exten => _x.,n(lan2),Gotoif($["${a}"="2"]?menu2,${EXTEN},1:lan0)
exten => _x.,n(lan0),Gotoif($["${a}"="0"]?menu0,${EXTEN},1:exen0,${EXTEN},1)
[exen0]                                                           ;欢迎提示按其它键的报错提示，然后重新回到welcome
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n,wait(1)
exten => _x.,n,Playback(stu/exen0)
exten => _x.,n,Gotoif($["1"="1"]?from-internal,${EXTEN},read1)
[menu1]                                                  ;按1键后的操作，输入学员拨号，进行查询
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n,wait(1)
exten => _x.,n(read1),Read(bhao,stu/stubhao,20,,2,5)
exten => _x.,n,Set(ID=${bhao})
exten => _x.,n,MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query resultidr ${connid} select s_uid/,s_relts from stu where s_uid=${ID})
exten => _x.,n,MySql(Fetch foundrow ${resultidr} s_uid s_relts)
exten => _x.,n,MySql(clear ${resultidr})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,Gotoif($["${ID}"="${s_uid}"]?jieg:read1)
exten => _x.,n(jieg),playback(stu/jieg)
;exten => _x.,n,Dial(SIP/${s_relts})
exten => _x.,n,SayNumber(${s_relts})
exten => _x.,n,Playback(stu/fen)
exten => _x.,n,Hangup()
[menu2]                                                ;人工查询后的操作
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n,Dial(SIP/8111,10)
exten => _x.,n,playback(stu/mang)
exten => _x.,n,Hangup()
[menu0]                                                  ;按0键后的操作，管理员使用
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n,MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query result ${connid} select s_pass from ampuser)
exten => _x.,n,MySql(Fetch foundrow ${result} s_pass)
exten => _x.,n,MySql(clear ${result})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,Authenticate(${s_pass})
exten => _x.,n(read1),Read(stubhao,stu/stucjivr,1,,2,5)
exten => _x.,n(lan1),Gotoif($["${stubhao}"="1"]?update,${EXTEN},1:lan2)
exten => _x.,n(lan2),Gotoif($["${stubhao}"="2"]?delete,${EXTEN},1:read1)
[update]                                       ;修改学员成绩拨号
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n(read1),Read(update,stu/update_stu,10,,2,5)
exten => _x.,n,MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query resultidr ${connid} select s_uid/,s_relts from stu where s_uid=${update})
exten => _x.,n,MySql(Fetch foundrow ${resultidr} s_uid s_relts)
exten => _x.,n,MySql(clear ${resultidr})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,Gotoif($["${update}"="${s_uid}"]?lanup:read1)
exten => _x.,n(lanup),Read(cj,stu/xhao1,10,,2,5)
exten => _x.,n,MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query resultidr ${connid} update stu set s_relts ='${cj}' where s_uid=${s_uid})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query resultidr ${connid} select s_uid/,s_relts from stu where s_uid=${update})
exten => _x.,n,MySql(Fetch foundrow ${resultidr} s_uid s_relts)
exten => _x.,n,MySql(clear ${resultidr})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,playback(stu/update_cj)
exten => _x.,n,SayNumber(${s_relts})
exten => _x.,n,Playback(stu/fen)
exten => _x.,n,Hangup()
[delete]                                                   ;删除错误的学员信息操作
exten => _x.,1,Answer(${EXTEN})
exten => _x.,n,NoOP(${EXTEN})
exten => _x.,n(delete1),Read(deletebhao,stu/delete_bhao,10,,2,5)
exten => _x.,n,MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query resultidr ${connid} select s_uid/,s_relts from stu where s_uid=${deletebhao})
exten => _x.,n,MySql(Fetch foundrow ${resultidr} s_uid s_relts)
exten => _x.,n,MySql(clear ${resultidr})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,Gotoif($["${deletebhao}"="${s_uid}"]?delete:delete1)
exten => _x.,n(delete),MySql(connect connid ${DBCurrentHost} ${DBuser} ${DBpass} ${DBname})
exten => _x.,n,MySql(query resultidr ${connid} delete from stu where s_uid=${deletebhao})
exten => _x.,n,MySql(disconnect ${connid})
exten => _x.,n,Playback(stu/delbhao)
exten => _x.,n,SayAlpha(${deletebhao})
exten => _x.,n,Playback(stu/deletejg)
exten => _x.,n,Hangup()
; 添加就木做了